<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>History ‚Äî SymptoCare</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <nav class="navbar">
    <a href="{{ url_for('home') }}" class="navbar-brand" style="text-decoration:none;">
      <span class="dot"></span> SymptoCare
    </a>
    <div class="navbar-links">
      <a href="{{ url_for('predict') }}">Check Symptoms</a>
      <div class="navbar-user">
        <div class="avatar">{{ session.username[0].upper() }}</div>
        {{ session.username }}
      </div>
      <a href="{{ url_for('logout') }}" class="btn-logout">Log out</a>
    </div>
  </nav>

  <div class="history-layout">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-item flash-{{ category }}" style="margin-bottom:16px;">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="history-top">
      <div>
        <h1 style="font-size:32px;color:var(--navy);margin-bottom:4px;">Search history</h1>
        <p style="color:var(--text-muted);font-size:14px;">Your personal symptom checks ‚Äî only visible to you</p>
      </div>
      {% if searches.items %}
      <form method="POST" action="{{ url_for('clear_history') }}" onsubmit="return confirm('Clear all history? This cannot be undone.');">
        <button type="submit" class="btn-danger">Clear all</button>
      </form>
      {% endif %}
    </div>

    {% if searches.items %}
    <div class="history-table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Symptoms entered</th>
            <th>Top condition</th>
            <th>Confidence</th>
            <th>Date</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for r in searches.items %}
          <tr>
            <td style="color:var(--text-light);font-size:13px;">{{ r.id }}</td>
            <td class="td-symptoms">{{ r.symptoms }}</td>
            <td><span class="disease-pill">{{ r.top_prediction or '‚Äî' }}</span></td>
            <td><span class="conf-badge">{{ r.confidence_pct() }}</span></td>
            <td class="td-time">{{ r.timestamp.strftime('%b %d, %Y ¬∑ %I:%M %p') }}</td>
            <td>
              <form method="POST" action="{{ url_for('delete_history', rid=r.id) }}" onsubmit="return confirm('Delete this record?');">
                <button type="submit" class="btn-danger-sm">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if searches.pages > 1 %}
    <div class="pagination">
      {% if searches.has_prev %}
        <a href="{{ url_for('history', page=searches.prev_num) }}">‚Üê Prev</a>
      {% endif %}
      {% for p in searches.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
          {% if p == searches.page %}
            <span class="current">{{ p }}</span>
          {% else %}
            <a href="{{ url_for('history', page=p) }}">{{ p }}</a>
          {% endif %}
        {% else %}
          <span style="padding:8px 6px;color:var(--text-light);">‚Ä¶</span>
        {% endif %}
      {% endfor %}
      {% if searches.has_next %}
        <a href="{{ url_for('history', page=searches.next_num) }}">Next ‚Üí</a>
      {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="empty-history">
      <div class="icon">ü©∫</div>
      <h3>No searches yet</h3>
      <p>Your symptom checks will appear here after you use the predictor.</p>
      <a href="{{ url_for('predict') }}" class="btn btn-primary">Check my symptoms ‚Üí</a>
    </div>
    {% endif %}

  </div>

</body>
</html>
