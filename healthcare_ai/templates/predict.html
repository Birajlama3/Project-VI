<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Check Symptoms — SymptoCare</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <nav class="navbar">
    <a href="{{ url_for('home') }}" class="navbar-brand" style="text-decoration:none;">
      <span class="dot"></span> SymptoCare
    </a>
    <div class="navbar-links">
      <a href="{{ url_for('history') }}">History</a>
      <div class="navbar-user">
        <div class="avatar">{{ session.username[0].upper() }}</div>
        {{ session.username }}
      </div>
      <a href="{{ url_for('logout') }}" class="btn-logout">Log out</a>
    </div>
  </nav>

  <div class="predict-layout">

    <div class="page-header">
      <h1>How are you feeling?</h1>
      <p>Describe your symptoms and we'll match them to common conditions</p>
    </div>

    <div class="disclaimer">
      <strong>⚠ Medical disclaimer:</strong> SymptoCare is an educational tool only — not a substitute for professional medical advice, diagnosis, or treatment. Always consult a qualified healthcare provider.
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-item flash-{{ category }}" style="margin-bottom:16px;">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if error %}
      <div class="alert-error" style="margin-bottom:16px;">{{ error }}</div>
    {% endif %}

    <div class="search-card">
      <label for="symptom-input">Enter your symptoms</label>
      <form method="POST" id="symptomForm">
        <div class="search-row">
          <input
            class="search-input"
            type="text"
            id="symptom-input"
            name="search_symptoms"
            placeholder="e.g. headache, fever, fatigue — or describe naturally"
            value="{{ search_symptoms or '' }}"
            maxlength="500"
            required
            autocomplete="off"
          >
          <button type="submit" class="btn btn-primary" id="submitBtn">Analyze →</button>
        </div>
        <div class="search-hint">Separate symptoms with commas, or just describe how you feel in plain English</div>
      </form>
    </div>

    <div id="loadingSpinner" class="loading-spinner" style="display:none;">
      <div class="spinner"></div>
      <p>Analyzing your symptoms…</p>
    </div>

    <!-- Results -->
    {% if matched_diseases or prediction %}
    <div class="result-section">

      <!-- Primary prediction -->
      <div class="result-card">
        <div class="result-card-header">
          <h3>Primary match</h3>
          {% if confidence_scores %}
            <span class="confidence-pill">
              <span class="dot"></span>
              {{ (confidence_scores[0][1] * 100)|round(1) }}% confidence
            </span>
          {% endif %}
        </div>

        <div class="top-disease">
          {{ confidence_scores[0][0] if confidence_scores else (top_diseases[0][0] if top_diseases else prediction) }}
        </div>

        {% if confidence_scores and confidence_scores|length > 1 %}
          <div class="alternatives-label">Other possibilities</div>
          <div class="alt-list">
            {% for disease, conf in confidence_scores[1:6] %}
              <div class="alt-item">
                <span>{{ disease }}</span>
                <span class="alt-pct">{{ (conf * 100)|round(1) }}%</span>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Remedies -->
      {% if remedies %}
      <div class="remedy-card">
        <h3>Home remedies</h3>
        <div class="remedy-disease">
          For {{ confidence_scores[0][0] if confidence_scores else top_diseases[0][0] }}
        </div>
        <ul class="remedy-list">
          {% for r in remedies %}
            <li>{{ r }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

    </div>

    {% elif search_symptoms %}
    <div class="no-match">
      <h3>No matches found</h3>
      <p>No conditions matched "<strong>{{ search_symptoms }}</strong>". Try different phrasing or check spelling.</p>
    </div>
    {% endif %}

    <div style="margin-top:32px;">
      <a href="{{ url_for('home') }}" class="btn btn-outline">← Back to home</a>
    </div>

  </div>

  <script>
    document.getElementById('symptomForm').addEventListener('submit', function() {
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('submitBtn').textContent = 'Analyzing…';
    });
  </script>

</body>
</html>
