<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Predict Disease — SymptoCare</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>


    <div class="prediction-card">
        <div class="disclaimer-banner">
            <strong>⚠️ Medical Disclaimer:</strong> SymptoCare is an educational tool for symptom information only. It is NOT a substitute for professional medical advice, diagnosis, or treatment. Always consult with a qualified healthcare provider for accurate medical guidance. Never delay seeking professional help based on information from this tool.
        </div>

        <h2>How are you feeling today?</h2>

        {% if error %}
            <div class="alert alert-error">{{ error }}</div>
        {% endif %}

        <form method="POST" class="search-form" id="symptomForm">
            <div class="assistant-row">
                <div style="flex:1">
                    <div class="search-row">
                        <input class="search-input" type="text" name="search_symptoms" placeholder="e.g. headache, fever, cough or describe your symptoms naturally" value="{{ search_symptoms or '' }}" maxlength="500" required>
                        <button type="submit" class="btn primary-btn" id="submitBtn">Analyze</button>
                    </div>
                    <p class="muted">Enter symptoms naturally, comma-separated, or just describe how you're feeling. We'll match them to common conditions.</p>
                </div>
            </div>
        </form>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner" style="display:none;">
            <div class="spinner"></div>
            <p>Analyzing your symptoms...</p>
        </div>

        {% if prediction %}
            <div class="result-box">
                <h3>Primary Prediction</h3>
                <p class="disease-primary">{{ prediction }}</p>
                {% if confidence_scores %}
                    <div class="confidence-badge">
                        <strong>{{ (confidence_scores[0][1] * 100)|round(1) }}%</strong> confidence
                    </div>
                    {% if confidence_scores|length > 1 %}
                        <p class="muted" style="margin-top:16px;">Other possibilities:</p>
                        <div class="confidence-list">
                            {% for disease, confidence in confidence_scores[1:6] %}
                                <div class="confidence-item">
                                    <span>{{ disease }}</span>
                                    <span class="confidence-percent">{{ (confidence * 100)|round(1) }}%</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endif %}
            </div>
            {% if remedies %}
                <div class="result-box" style="margin-top:12px;background:#fffaf0;border-left-color:#f59e0b;">
                    <h3>Suggested Home Remedies</h3>
                    <p class="muted">For: <strong>{{ prediction }}</strong></p>
                    <ul class="remedies-list">
                        {% for r in remedies %}
                            <li>{{ r }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        {% endif %}

        {% if matched_diseases %}
            <div class="result-box">
                <h3>Likely Conditions</h3>
                <p class="disease-primary">{{ top_diseases[0][0] }}</p>
                {% if top_diseases|length > 1 %}
                    <p class="muted" style="margin-top:8px;">Other possibilities:</p>
                    <ul class="disease-simple">
                        {% for d, cnt in top_diseases[1:6] %}
                            <li>{{ d }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
            {% if remedies %}
                <div class="result-box" style="margin-top:12px;background:#fffaf0;border-left-color:#f59e0b;">
                    <h3>Suggested Home Remedies</h3>
                    <p class="muted">For: <strong>{{ top_diseases[0][0] }}</strong></p>
                    <ul class="remedies-list">
                        {% for r in remedies %}
                            <li>{{ r }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        {% elif search_symptoms is defined and search_symptoms %}
            <div class="result-box">
                <h3>No matches</h3>
                <p class="muted">No dataset rows match '{{ search_symptoms }}'. Try slightly different symptom terms or check spelling.</p>
            </div>
        {% endif %}

        <div style="text-align:center;margin-top:18px;">
            <a href="{{ url_for('home') }}" class="btn secondary-btn">Back to Home</a>
        </div>
    </div>

    <script>
        document.getElementById('symptomForm').addEventListener('submit', function() {
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('submitBtn').disabled = true;
        });
    </script>
</body>
</html>